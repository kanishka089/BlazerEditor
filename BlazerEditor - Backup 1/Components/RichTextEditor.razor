@using Microsoft.JSInterop
@inject IJSRuntime JS

<div class="rich-text-editor">
    <div class="rte-toolbar">
        <div class="toolbar-group">
            <button type="button" class="rte-btn" @onclick="MakeBold" title="Bold">
                <strong>B</strong>
            </button>
            <button type="button" class="rte-btn" @onclick="MakeItalic" title="Italic">
                <em>I</em>
            </button>
            <button type="button" class="rte-btn" @onclick="MakeUnderline" title="Underline">
                <u>U</u>
            </button>
            <button type="button" class="rte-btn" @onclick="MakeStrike" title="Strikethrough">
                <s>S</s>
            </button>
        </div>

        <div class="toolbar-separator"></div>

        <div class="toolbar-group">
            <button type="button" class="rte-btn" @onclick="MakeH1" title="Heading 1">
                H1
            </button>
            <button type="button" class="rte-btn" @onclick="MakeH2" title="Heading 2">
                H2
            </button>
            <button type="button" class="rte-btn" @onclick="MakeParagraph" title="Paragraph">
                P
            </button>
        </div>

        <div class="toolbar-separator"></div>

        <div class="toolbar-group">
            <button type="button" class="rte-btn" @onclick="InsertLink" title="Insert Link">
                ðŸ”—
            </button>
        </div>

        <div class="toolbar-separator"></div>

        <div class="toolbar-group">
            <button type="button" class="rte-btn" @onclick="MakeSuperscript" title="Superscript">
                xÂ²
            </button>
            <button type="button" class="rte-btn" @onclick="MakeSubscript" title="Subscript">
                xâ‚‚
            </button>
        </div>
    </div>

    <textarea class="rte-textarea" 
              @bind="CurrentValue" 
              @bind:event="oninput"
              @onfocus="HandleFocus"
              rows="8"
              placeholder="Enter your text here..."></textarea>
</div>

@code {
    [Parameter] public string Value { get; set; } = "";
    [Parameter] public EventCallback<string> ValueChanged { get; set; }

    private string CurrentValue
    {
        get => Value;
        set
        {
            Value = value;
            ValueChanged.InvokeAsync(value);
        }
    }

    private void HandleFocus()
    {
        // Clear placeholder text on first focus
        if (CurrentValue == "<p>Enter your text here...</p>" ||
            CurrentValue.Contains("Enter your text here") ||
            CurrentValue == "Your Heading" ||
            CurrentValue.Contains("Your Heading"))
        {
            CurrentValue = "";
        }
    }

    private void MakeBold() => AppendTag("strong");
    private void MakeItalic() => AppendTag("em");
    private void MakeUnderline() => AppendTag("u");
    private void MakeStrike() => AppendTag("s");
    private void MakeH1() => AppendTag("h1");
    private void MakeH2() => AppendTag("h2");
    private void MakeParagraph() => AppendTag("p");
    private void MakeSuperscript() => AppendTag("sup");
    private void MakeSubscript() => AppendTag("sub");

    private void AppendTag(string tag)
    {
        var openTag = $"<{tag}>";
        var closeTag = $"</{tag}>";
        CurrentValue += $"{openTag}text{closeTag}";
    }

    private void InsertLink()
    {
        CurrentValue += "<a href=\"#\">link text</a>";
    }
}
